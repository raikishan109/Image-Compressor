<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBify - Multi Compressor</title>
    <link rel="icon" type="image/png"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%233b82f6'/><stop offset='100%25' style='stop-color:%23f97316'/></linearGradient></defs><circle cx='50' cy='50' r='45' fill='url(%23grad)'/><text x='50' y='65' font-family='Arial,sans-serif' font-size='40' font-weight='bold' fill='white' text-anchor='middle'>KB</text></svg>">
    <meta name="description"
        content="Compress your images instantly with our modern image compression tool. Support for JPG, PNG, and WEBP formats.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #141414;
            --accent-primary: #fafafa;
            --accent-secondary: #fafafa;
            --accent-gradient: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --border-color: #1f1f1f;
            --success: #10b981;
            --error: #ef4444;
            --shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        [data-theme="light"] {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0f0f0;
            --text-primary: #0a0a0a;
            --text-secondary: #525252;
            --border-color: #d4d4d4;
            --shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            animation: fadeInDown 0.6s ease;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            animation: fadeInUp 0.6s ease;
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-color);
            padding: 1rem 2rem;
            z-index: 999;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .navbar-logo {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            object-fit: cover;
        }

        .navbar-brand .kb {
            color: #3b82f6;
        }

        .navbar-brand .ify {
            color: #f97316;
        }

        .container {
            margin-top: 80px;
        }

        .file-type-tabs {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .tab-btn {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            padding: 0.875rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .tab-btn:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .theme-toggle {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .theme-icon {
            width: 20px;
            height: 20px;
            fill: var(--text-primary);
        }

        .upload-section {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 2px dashed var(--border-color);
            transition: all 0.3s ease;
            animation: fadeIn 0.8s ease;
        }

        .upload-section.drag-over {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
            transform: scale(1.02);
        }

        .upload-box {
            text-align: center;
            cursor: pointer;
            padding: 2rem;
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            opacity: 0.6;
        }

        .upload-icon svg {
            width: 100%;
            height: 100%;
            fill: var(--text-primary);
        }

        .upload-text {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
            background-size: 200% 200%;
            color: white;
            border: none;
            padding: 0.875rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background-position: right center;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .options-section {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .options-section.active {
            display: block;
        }

        .option-group {
            margin-bottom: 2rem;
        }

        .option-label {
            font-weight: 600;
            margin-bottom: 1rem;
            display: block;
            font-size: 1.1rem;
        }

        .size-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .size-btn {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--text-primary);
        }

        .size-btn:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .size-btn.active {
            background: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
            color: white;
            border-color: transparent;
        }

        .custom-input {
            width: 100%;
            padding: 0.875rem;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .custom-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .slider-container {
            margin-top: 1rem;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: var(--bg-tertiary);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-gradient);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(99, 102, 241, 0.5);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-gradient);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(99, 102, 241, 0.5);
        }

        .slider-value {
            display: inline-block;
            margin-left: 1rem;
            font-weight: 600;
            color: var(--accent-primary);
        }

        .preview-section {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
            animation: fadeIn 0.5s ease;
        }

        .preview-section.active {
            display: grid;
        }

        .preview-card {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .preview-title {
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .preview-img {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 1rem;
            max-height: 300px;
            object-fit: contain;
            background: var(--bg-tertiary);
        }

        .preview-info {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .info-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .info-value {
            font-weight: 600;
        }

        .loader {
            display: none;
            justify-content: center;
            align-items: center;
            margin: 2rem 0;
        }

        .loader.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .progress-container {
            display: none;
            margin: 2rem 0;
            animation: fadeIn 0.5s ease;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: var(--bg-tertiary);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-gradient);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .error-message {
            background: var(--error);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            display: none;
            animation: shake 0.5s ease;
        }

        .error-message.active {
            display: block;
        }

        .success-message {
            background: var(--success);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            display: none;
        }

        .success-message.active {
            display: block;
        }

        .action-buttons {
            display: none;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .action-buttons.active {
            display: flex;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--border-color);
            animation: slideUp 0.4s ease;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: var(--bg-tertiary);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .modal-close:hover {
            background: var(--accent-primary);
            transform: rotate(90deg);
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            animation: bounce 0.6s ease;
        }

        .modal-icon svg {
            width: 100%;
            height: 100%;
            fill: var(--accent-primary);
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1rem;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-stats {
            background: var(--bg-tertiary);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .modal-stat-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-stat-row:last-child {
            border-bottom: none;
        }

        .modal-stat-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .modal-stat-value {
            font-weight: 700;
            color: var(--accent-primary);
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .modal-btn {
            flex: 1;
            background: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.6);
        }

        .modal-btn.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            box-shadow: none;
        }

        .modal-btn.secondary:hover {
            background: var(--border-color);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .container {
                padding: 1rem;
            }

            .upload-section {
                padding: 2rem 1rem;
            }

            .size-options {
                grid-template-columns: 1fr;
            }

            .preview-section {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .theme-toggle {
                top: 1rem;
                right: 1rem;
            }
        }

        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
        }

        .footer p {
            margin: 0.5rem 0;
        }

        .footer a {
            background: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
            font-weight: 600;
            transition: opacity 0.3s ease;
        }

        .footer a:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%233b82f6'/%3E%3Cstop offset='100%25' style='stop-color:%23f97316'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='100' cy='100' r='90' fill='url(%23bg)'/%3E%3Ctext x='100' y='135' font-family='Arial,sans-serif' font-size='80' font-weight='bold' fill='white' text-anchor='middle'%3EKB%3C/text%3E%3Cg transform='translate(140,40)'%3E%3Crect x='0' y='0' width='12' height='12' fill='%233b82f6'/%3E%3Crect x='15' y='0' width='12' height='12' fill='%23f97316'/%3E%3Crect x='0' y='15' width='12' height='12' fill='%23f97316'/%3E%3Crect x='15' y='15' width='12' height='12' fill='%233b82f6'/%3E%3Crect x='30' y='0' width='12' height='12' fill='%233b82f6'/%3E%3Crect x='30' y='15' width='12' height='12' fill='%23f97316'/%3E%3Crect x='0' y='30' width='12' height='12' fill='%23f97316'/%3E%3Crect x='15' y='30' width='12' height='12' fill='%233b82f6'/%3E%3C/g%3E%3C/svg%3E"
                alt="KBify Logo" class="navbar-logo">
            <div>
                <span class="kb">KB</span><span class="ify">ify</span>
            </div>
        </div>
        <div class="theme-toggle" onclick="toggleTheme()">
            <svg class="theme-icon" id="themeIcon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
            <span id="themeText">Dark</span>
        </div>
    </nav>

    <div class="container">
        <header>
            <h1 id="mainTitle">Image Compressor</h1>
            <p class="subtitle" id="mainSubtitle">Compress your images instantly with advanced compression</p>
        </header>

        <div class="file-type-tabs">
            <button class="tab-btn active" onclick="switchFileType('image')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    style="display: inline-block; vertical-align: middle; margin-right: 5px;">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                    <circle cx="8.5" cy="8.5" r="1.5" />
                    <polyline points="21 15 16 10 5 21" />
                </svg>
                Image
            </button>
            <button class="tab-btn" onclick="switchFileType('pdf')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    style="display: inline-block; vertical-align: middle; margin-right: 5px;">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" y1="13" x2="8" y2="13" />
                    <line x1="16" y1="17" x2="8" y2="17" />
                    <polyline points="10 9 9 9 8 9" />
                </svg>
                PDF
            </button>
        </div>

        <div class="upload-section" id="uploadSection">
            <div class="upload-box" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" y1="3" x2="12" y2="15" />
                    </svg>
                </div>
                <p class="upload-text">Click to upload or drag & drop</p>
                <p class="upload-hint" id="uploadHint">Supports JPG, PNG, WEBP</p>
            </div>
            <input type="file" id="fileInput" accept="image/jpeg,image/png,image/webp">
        </div>

        <div class="options-section" id="optionsSection">
            <div class="option-group">
                <label class="option-label">Target File Size</label>
                <div class="size-options">
                    <button class="size-btn" onclick="selectSize(50)">50 KB</button>
                    <button class="size-btn" onclick="selectSize(100)">100 KB</button>
                    <button class="size-btn" onclick="selectSize(200)">200 KB</button>
                    <button class="size-btn active" onclick="selectSize('custom')">Custom</button>
                </div>
                <input type="number" class="custom-input" id="customSize" placeholder="Enter size in KB" value="100"
                    min="1">
            </div>

            <div class="option-group">
                <label class="option-label">
                    Image Quality
                    <span class="slider-value" id="qualityValue">0.8</span>
                </label>
                <div class="slider-container">
                    <input type="range" class="slider" id="qualitySlider" min="0.1" max="1" step="0.1" value="0.8">
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn" onclick="compressImage()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10" />
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
                    </svg>
                    Compress Image
                </button>
            </div>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
        </div>

        <div class="loader" id="loader">
            <div class="spinner"></div>
        </div>

        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <div class="preview-section" id="previewSection">
            <div class="preview-card">
                <h3 class="preview-title">Original Image</h3>
                <img id="originalPreview" class="preview-img" alt="Original">
                <div class="preview-info">
                    <span class="info-label">Size:</span>
                    <span class="info-value" id="originalSize">-</span>
                </div>
                <div class="preview-info">
                    <span class="info-label">Dimensions:</span>
                    <span class="info-value" id="originalDimensions">-</span>
                </div>
            </div>

            <div class="preview-card">
                <h3 class="preview-title">Compressed Image</h3>
                <img id="compressedPreview" class="preview-img" alt="Compressed">
                <div class="preview-info">
                    <span class="info-label">Size:</span>
                    <span class="info-value" id="compressedSize">-</span>
                </div>
                <div class="preview-info">
                    <span class="info-label">Reduction:</span>
                    <span class="info-value" id="reduction">-</span>
                </div>
            </div>
        </div>

        <div class="action-buttons" id="actionButtons">
            <button class="btn" onclick="downloadImage()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
                Download Compressed
            </button>
            <button class="btn" onclick="reset()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10" />
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
                </svg>
                Compress Another
            </button>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">✕</button>
            <div class="modal-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                    <path d="M8 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
            <h2 class="modal-title">Compression Successful!</h2>
            <div class="modal-stats">
                <div class="modal-stat-row">
                    <span class="modal-stat-label">Original Size</span>
                    <span class="modal-stat-value" id="modalOriginalSize">-</span>
                </div>
                <div class="modal-stat-row">
                    <span class="modal-stat-label">Compressed Size</span>
                    <span class="modal-stat-value" id="modalCompressedSize">-</span>
                </div>
                <div class="modal-stat-row">
                    <span class="modal-stat-label">Size Reduction</span>
                    <span class="modal-stat-value" id="modalReduction">-</span>
                </div>
                <div class="modal-stat-row">
                    <span class="modal-stat-label">Saved Space</span>
                    <span class="modal-stat-value" id="modalSavedSpace">-</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="downloadFromModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="7 10 12 15 17 10" />
                        <line x1="12" y1="15" x2="12" y2="3" />
                    </svg>
                    Download Now
                </button>
                <button class="modal-btn secondary" onclick="closeModal()">
                    Close
                </button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>© 2026 KBify. All rights reserved.</p>
        <p>Built By <a href="https://insolze.in" target="_blank">Team InSolze</a></p>
    </footer>

    <script>
        let originalFile = null;
        let compressedBlob = null;
        let selectedSize = 'custom';
        let currentFileType = 'image';

        // Theme Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);

            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');

            if (newTheme === 'light') {
                themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>';
                themeText.textContent = 'Light';
            } else {
                themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>';
                themeText.textContent = 'Dark';
            }

            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'light') {
                toggleTheme();
            }
        });

        // Quality Slider
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        qualitySlider.addEventListener('input', (e) => {
            qualityValue.textContent = e.target.value;
        });

        // File Type Switch
        function switchFileType(type) {
            currentFileType = type;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const mainTitle = document.getElementById('mainTitle');
            const mainSubtitle = document.getElementById('mainSubtitle');
            const uploadHint = document.getElementById('uploadHint');
            const fileInput = document.getElementById('fileInput');

            if (type === 'pdf') {
                mainTitle.textContent = 'PDF Compressor';
                mainSubtitle.textContent = 'Compress your PDF files instantly';
                uploadHint.textContent = 'Supports PDF files';
                fileInput.accept = 'application/pdf';
            } else {
                mainTitle.textContent = 'Image Compressor';
                mainSubtitle.textContent = 'Compress your images instantly with advanced compression';
                uploadHint.textContent = 'Supports JPG, PNG, WEBP';
                fileInput.accept = 'image/jpeg,image/png,image/webp';
            }

            reset();
        }

        // Size Selection
        function selectSize(size) {
            selectedSize = size;
            document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (size !== 'custom') {
                document.getElementById('customSize').value = size;
            }
        }

        // File Input
        const fileInput = document.getElementById('fileInput');
        const uploadSection = document.getElementById('uploadSection');

        fileInput.addEventListener('change', handleFileSelect);

        // Drag and Drop
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('drag-over');
        });

        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('drag-over');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('drag-over');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (currentFileType === 'image' && !file.type.match('image/(jpeg|png|webp)')) {
                showError('Please select a valid image file (JPG, PNG, or WEBP)');
                return;
            }

            if (currentFileType === 'pdf' && file.type !== 'application/pdf') {
                showError('Please select a valid PDF file');
                return;
            }

            originalFile = file;

            if (currentFileType === 'image') {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        document.getElementById('originalPreview').src = e.target.result;
                        document.getElementById('originalSize').textContent = formatFileSize(file.size);
                        document.getElementById('originalDimensions').textContent = `${img.width} × ${img.height}`;

                        document.getElementById('optionsSection').classList.add('active');
                        document.getElementById('previewSection').classList.add('active');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('originalPreview').style.display = 'none';
                document.getElementById('originalSize').textContent = formatFileSize(file.size);
                document.getElementById('originalDimensions').textContent = 'PDF Document';

                document.getElementById('optionsSection').classList.add('active');
                document.getElementById('previewSection').classList.add('active');
            }
        }

        async function compressImage() {
            if (!originalFile) {
                showError(`Please select ${currentFileType === 'pdf' ? 'a PDF' : 'an image'} first`);
                return;
            }

            if (currentFileType === 'pdf') {
                await compressPDF();
                return;
            }

            const targetSizeKB = parseInt(document.getElementById('customSize').value);
            if (!targetSizeKB || targetSizeKB < 1) {
                showError('Please enter a valid target size');
                return;
            }

            const targetSizeBytes = targetSizeKB * 1024;
            let quality = parseFloat(document.getElementById('qualitySlider').value);

            hideMessages();
            document.getElementById('loader').classList.add('active');
            document.getElementById('progressContainer').classList.add('active');
            updateProgress(0);

            try {
                const img = await loadImage(originalFile);
                let attempts = 0;
                const maxAttempts = 20;
                let lastBlob = null;
                let minQuality = 0.1;
                let maxQuality = quality;
                let mimeType = originalFile.type;

                // If PNG and target size is small, try JPEG conversion for better compression
                let convertedToJPEG = false;

                while (attempts < maxAttempts) {
                    attempts++;
                    const progress = (attempts / maxAttempts) * 100;
                    updateProgress(Math.min(progress, 95));

                    const blob = await compressWithQuality(img, quality, mimeType);
                    lastBlob = blob;

                    const sizeDiff = blob.size - targetSizeBytes;
                    const tolerance = targetSizeBytes * 0.05;

                    if (Math.abs(sizeDiff) <= tolerance) {
                        compressedBlob = blob;
                        break;
                    }

                    if (blob.size > targetSizeBytes) {
                        maxQuality = quality;
                        quality = (minQuality + quality) / 2;
                    } else {
                        minQuality = quality;
                        quality = (quality + maxQuality) / 2;
                    }

                    if (maxQuality - minQuality < 0.01) {
                        // If PNG compression failed and we haven't tried JPEG yet
                        if (mimeType === 'image/png' && !convertedToJPEG && blob.size > targetSizeBytes) {
                            convertedToJPEG = true;
                            mimeType = 'image/jpeg';
                            minQuality = 0.1;
                            maxQuality = 0.8;
                            quality = 0.5;
                            attempts = 0; // Reset attempts for JPEG compression
                            continue;
                        }
                        compressedBlob = blob;
                        break;
                    }

                    await new Promise(resolve => setTimeout(resolve, 50));
                }

                if (!compressedBlob) {
                    compressedBlob = lastBlob;
                }

                if (compressedBlob.size > originalFile.size) {
                    showError(`Unable to compress to ${targetSizeKB}KB. Minimum achievable size is ${formatFileSize(compressedBlob.size)}`);
                    compressedBlob = null;
                } else {
                    updateProgress(100);
                    displayCompressedImage();
                    if (convertedToJPEG) {
                        showSuccess('Image compressed successfully! (Converted PNG to JPEG for better compression)');
                    } else {
                        showSuccess('Image compressed successfully!');
                    }
                }
            } catch (error) {
                showError('Compression failed: ' + error.message);
            } finally {
                document.getElementById('loader').classList.remove('active');
                setTimeout(() => {
                    document.getElementById('progressContainer').classList.remove('active');
                }, 1000);
            }
        }

        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function compressWithQuality(img, quality, mimeType) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;

                const ctx = canvas.getContext('2d');

                // Only fill white background for JPEG (which doesn't support transparency)
                if (mimeType === 'image/jpeg') {
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                ctx.drawImage(img, 0, 0);

                canvas.toBlob((blob) => {
                    if (blob) {
                        resolve(blob);
                    } else {
                        reject(new Error('Failed to compress image'));
                    }
                }, mimeType, quality);
            });
        }

        async function compressPDF() {
            hideMessages();
            document.getElementById('loader').classList.add('active');
            document.getElementById('progressContainer').classList.add('active');
            updateProgress(0);

            try {
                const arrayBuffer = await originalFile.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

                updateProgress(30);

                const compressedPdfBytes = await pdfDoc.save({
                    useObjectStreams: false,
                    addDefaultPage: false,
                    objectsPerTick: 50,
                });

                updateProgress(70);

                compressedBlob = new Blob([compressedPdfBytes], { type: 'application/pdf' });

                updateProgress(100);
                displayCompressedImage();
                showSuccess('PDF compressed successfully!');
            } catch (error) {
                showError('PDF compression failed: ' + error.message);
            } finally {
                document.getElementById('loader').classList.remove('active');
                setTimeout(() => {
                    document.getElementById('progressContainer').classList.remove('active');
                }, 1000);
            }
        }

        function displayCompressedImage() {
            if (currentFileType === 'pdf') {
                document.getElementById('compressedPreview').style.display = 'none';
            } else {
                const url = URL.createObjectURL(compressedBlob);
                document.getElementById('compressedPreview').src = url;
            }
            document.getElementById('compressedSize').textContent = formatFileSize(compressedBlob.size);

            const reduction = ((1 - compressedBlob.size / originalFile.size) * 100).toFixed(1);
            const savedSpace = originalFile.size - compressedBlob.size;

            document.getElementById('reduction').textContent = `${reduction}%`;
            document.getElementById('actionButtons').classList.add('active');

            // Show modal with stats
            document.getElementById('modalOriginalSize').textContent = formatFileSize(originalFile.size);
            document.getElementById('modalCompressedSize').textContent = formatFileSize(compressedBlob.size);
            document.getElementById('modalReduction').textContent = `${reduction}%`;
            document.getElementById('modalSavedSpace').textContent = formatFileSize(savedSpace);
            document.getElementById('successModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        function downloadFromModal() {
            downloadImage();
            closeModal();
        }

        function downloadImage() {
            if (!compressedBlob) return;

            const url = URL.createObjectURL(compressedBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `compressed_${originalFile.name}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function reset() {
            originalFile = null;
            compressedBlob = null;

            document.getElementById('fileInput').value = '';
            document.getElementById('optionsSection').classList.remove('active');
            document.getElementById('previewSection').classList.remove('active');
            document.getElementById('actionButtons').classList.remove('active');
            document.getElementById('progressContainer').classList.remove('active');

            hideMessages();
            updateProgress(0);
        }

        function updateProgress(percent) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percent + '%';
            progressFill.textContent = Math.round(percent) + '%';
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = '❌ ' + message;
            errorEl.classList.add('active');
            setTimeout(() => errorEl.classList.remove('active'), 5000);
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = '✅ ' + message;
            successEl.classList.add('active');
            setTimeout(() => successEl.classList.remove('active'), 3000);
        }

        function hideMessages() {
            document.getElementById('errorMessage').classList.remove('active');
            document.getElementById('successMessage').classList.remove('active');
        }
    </script>
</body>

</html>